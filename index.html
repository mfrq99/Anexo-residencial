<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anexo Residencial UC Christus</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBhN4t3uGfDwRZwN9r_k7egf5PjssfofJI",
  authDomain: "residencial-6b6b7.firebaseapp.com",
  databaseURL: "https://residencial-6b6b7-default-rtdb.firebaseio.com",
  projectId: "residencial-6b6b7",
  storageBucket: "residencial-6b6b7.firebasestorage.app",
  messagingSenderId: "171840259391",
  appId: "1:171840259391:web:c8d26aec2fc91f8058bf8a"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<style>
body { font-family:'Segoe UI',sans-serif;background:#eef2f7;margin:0;padding:10px }
.container{max-width:500px;margin:auto;background:white;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);overflow:hidden}
.header{background:#007bff;color:white;padding:20px;text-align:center}
.nav{display:flex;background:#f8f9fa}
.nav div{flex:1;padding:10px;text-align:center;cursor:pointer;font-weight:bold;font-size:11px}
.nav div.active{background:white;color:#007bff;border-bottom:3px solid #007bff}
.section{display:none;padding:20px}
.section.active{display:block}
input,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
button{background:#28a745;color:white;font-weight:bold;border:none}
ul{padding-left:20px}
.info-box{background:#f1f8ff;padding:10px;border-radius:8px;margin-top:10px}
hr{border:none;border-top:1px solid #eee;margin:15px 0}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h2>Anexo Residencial UC Christus</h2>
<small>Unidad de RecuperaciÃ³n y Regaloneo</small>
</div>

<div class="nav">
<div class="active" onclick="openTab('inicio',this)">RESIDENCIA</div>
<div onclick="openTab('paciente',this)">PACIENTE</div>
<div onclick="openTab('equipo',this)">EQUIPO MÃ‰DICO</div>
</div>

<!-- RESIDENCIA -->
<div id="inicio" class="section active">
<div class="info-box">
ğŸ‘‰ Para ver ficha clÃ­nica o reservar visitas debe ingresar a <b>Paciente</b>.
</div>
</div>

<!-- PACIENTE -->
<div id="paciente" class="section">

<h3>Acceso Paciente</h3>

<div id="loginBox">
<input id="rut" placeholder="RUT sin puntos y con guion">
<input id="fecha" type="date">
<button onclick="loginPaciente()">Ingresar</button>
</div>

<div id="ficha" style="display:none">

<h4>Ficha ClÃ­nica</h4>
<div class="info-box">
<b>Margarita De Las Mercedes Arriaza Zamorano</b><br>
Nacimiento: 06-01-1951<br>
Unidad: RecuperaciÃ³n CardÃ­aca Domiciliaria<br>
MÃ©dico: Dr. Hazelnut Teo
</div>

<hr>
<h4>MedicaciÃ³n</h4>
<ul id="listaMedicacion"></ul>

<hr>
<h4>Controles</h4>
<ul id="listaControlesPaciente"></ul>

<hr>
<h4>ExÃ¡menes</h4>
<ul id="listaExamenesPaciente"></ul>

</div>
</div>

<!-- EQUIPO -->
<div id="equipo" class="section">

<h3>Equipo MÃ©dico</h3>

<h4>ğŸ’Š MedicaciÃ³n</h4>
<input id="medNombre" placeholder="Nombre medicamento">
<input id="medHorarios" placeholder="Horarios (ej: 08:00,14:00,20:00)">
<button onclick="guardarMedicacion()">Guardar</button>
<ul id="listaMedicacionEquipo"></ul>

<hr>

<h4>ğŸ“‹ Controles</h4>
<input id="controlDesc" placeholder="DescripciÃ³n">
<input id="controlFecha" type="date">
<input id="controlHora" type="time">
<button onclick="agregarControl()">Agregar</button>
<ul id="listaControles"></ul>

<hr>

<h4>ğŸ§ª ExÃ¡menes</h4>
<input id="examenDesc" placeholder="DescripciÃ³n">
<input id="examenFecha" type="date">
<input id="examenHora" type="time">
<button onclick="agregarExamen()">Agregar</button>
<ul id="listaExamenes"></ul>

</div>

</div>

<script>
const PACIENTE_RUT="6921444-4";
const PACIENTE_FECHA="1951-01-06";

function loginPaciente(){
  if(rut.value===PACIENTE_RUT && fecha.value===PACIENTE_FECHA){
    loginBox.style.display="none";
    ficha.style.display="block";
  } else alert("Datos incorrectos");
}

function openTab(id,el){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll(".nav div").forEach(n=>n.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  el.classList.add("active");
}

function guardarMedicacion(){
  const horarios = medHorarios.value.split(",").map(h=>h.trim());
  database.ref("equipo_medico/medicacion").push({
    nombre:medNombre.value,
    horarios
  });
  medNombre.value=medHorarios.value="";
}

function agregarControl(){
  database.ref("equipo_medico/controles").push({
    descripcion:controlDesc.value,
    fecha:controlFecha.value,
    hora:controlHora.value
  });
}

function agregarExamen(){
  database.ref("equipo_medico/examenes").push({
    descripcion:examenDesc.value,
    fecha:examenFecha.value,
    hora:examenHora.value
  });
}

function borrar(ruta){
  if(confirm("Â¿Eliminar?")) database.ref(ruta).remove();
}

/* LISTENERS */
database.ref("equipo_medico/medicacion").on("value",snap=>{
  listaMedicacion.innerHTML="";
  listaMedicacionEquipo.innerHTML="";
  snap.forEach(i=>{
    const d=i.val();
    listaMedicacion.innerHTML+=
      `<li>ğŸ’Š ${d.nombre}<br>â° ${d.horarios.join(", ")}</li>`;
    listaMedicacionEquipo.innerHTML+=
      `<li>${d.nombre} (${d.horarios.join(", ")})
      <button onclick="borrar('equipo_medico/medicacion/${i.key}')">ğŸ—‘ï¸</button></li>`;
  });
});

database.ref("equipo_medico/controles").on("value",snap=>{
  listaControles.innerHTML="";
  listaControlesPaciente.innerHTML="";
  snap.forEach(i=>{
    const d=i.val();
    const t=`ğŸ“‹ ${d.descripcion} â€” ${d.fecha} ${d.hora}`;
    listaControles.innerHTML+=`<li>${t}<button onclick="borrar('equipo_medico/controles/${i.key}')">ğŸ—‘ï¸</button></li>`;
    listaControlesPaciente.innerHTML+=`<li>${t}</li>`;
  });
});

database.ref("equipo_medico/examenes").on("value",snap=>{
  listaExamenes.innerHTML="";
  listaExamenesPaciente.innerHTML="";
  snap.forEach(i=>{
    const d=i.val();
    const t=`ğŸ§ª ${d.descripcion} â€” ${d.fecha} ${d.hora}`;
    listaExamenes.innerHTML+=`<li>${t}<button onclick="borrar('equipo_medico/examenes/${i.key}')">ğŸ—‘ï¸</button></li>`;
    listaExamenesPaciente.innerHTML+=`<li>${t}</li>`;
  });
});
</script>

</body>
</html>
