<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anexo Residencial UC Christus</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f6fa;
  margin: 0;
}
header {
  background: #0056b3;
  color: white;
  padding: 15px;
  text-align: center;
}
section {
  background: white;
  margin: 15px;
  padding: 15px;
  border-radius: 10px;
}
button {
  background: #007bff;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
button.danger { background: #dc3545; }
input {
  width: 100%;
  padding: 7px;
  margin: 5px 0;
}
details {
  margin-top: 10px;
}
.confirm {
  color: green;
  font-weight: bold;
}
</style>
</head>

<body>

<header>
<h2>Anexo Residencial UC Christus</h2>
<p>GestiÃ³n interna de paciente</p>
</header>

<!-- LOGIN -->
<section id="login">
<h3>Acceso Paciente</h3>
<p><small>Ingrese RUT sin puntos y con guiÃ³n</small></p>
<input id="rut" placeholder="6921444-4">
<input id="fecha" placeholder="1951-01-06" type="date">
<button onclick="login()">Ingresar</button>
<p id="loginError" style="color:red"></p>
</section>

<!-- PACIENTE -->
<section id="paciente" style="display:none">
<h3>ğŸ‘µ Ficha del Paciente</h3>
<p><b>Nombre:</b> Abuelita VIP</p>
<p><b>Ingreso:</b> Enero 2026</p>
<p><b>Unidad:</b> Anexo Residencial UC Christus</p>

<p>
<b>MÃ©dico tratante:</b>
<a href="#" onclick="verDoctor()">Dr. Hazelnut Teo</a>
</p>

<details>
<summary>ğŸ’Š MedicaciÃ³n</summary>
<ul id="listaMedicacion"></ul>
</details>

<details>
<summary>ğŸ©º Controles</summary>
<ul id="listaControles"></ul>
</details>

<details>
<summary>ğŸ§ª ExÃ¡menes</summary>
<ul id="listaExamenes"></ul>
</details>

<details>
<summary>ğŸ“ˆ Toma de PresiÃ³n</summary>
<ul id="listaPresion"></ul>
</details>

<a href="https://calendly.com/mfrq89/30min" target="_blank">
<button>ğŸ“… Reservar visita</button>
</a>
</section>

<!-- EQUIPO MÃ‰DICO -->
<section id="equipo">
<h3>ğŸ‘¨â€âš•ï¸ Equipo MÃ©dico</h3>

<h4>Agregar MedicaciÃ³n</h4>
<input id="medNombre" placeholder="Medicamento">
<input id="medHorario" placeholder="Horario">
<button onclick="agregarMedicacion()">Guardar</button>

<h4>Agregar Control</h4>
<input id="controlNombre" placeholder="Control">
<input id="controlFecha" type="datetime-local">
<button onclick="agregarControl()">Guardar</button>

<h4>Agregar Examen</h4>
<input id="examNombre" placeholder="Examen">
<input id="examFecha" type="datetime-local">
<button onclick="agregarExamen()">Guardar</button>

<h4>Toma de PresiÃ³n</h4>
<input id="p1" placeholder="MediciÃ³n 1">
<input id="p2" placeholder="MediciÃ³n 2">
<input id="p3" placeholder="MediciÃ³n 3">
<button onclick="agregarPresion()">Guardar</button>

<p id="confirmacion" class="confirm"></p>
</section>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBhN4t3uGfDwRZwN9r_k7egf5PjssfofJI",
  authDomain: "residencial-6b6b7.firebaseapp.com",
  databaseURL: "https://residencial-6b6b7-default-rtdb.firebaseio.com",
  projectId: "residencial-6b6b7",
  storageBucket: "residencial-6b6b7.appspot.com",
  messagingSenderId: "171840259391",
  appId: "1:171840259391:web:c8d26aec2fc91f8058bf8a"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function login() {
  const rut = document.getElementById("rut").value;
  const fecha = document.getElementById("fecha").value;

  if (rut === "6921444-4" && fecha === "1951-01-06") {
    document.getElementById("login").style.display = "none";
    document.getElementById("paciente").style.display = "block";
    cargarDatos();
  } else {
    document.getElementById("loginError").innerText = "Datos incorrectos";
  }
}

function verDoctor() {
  alert("Dr. Hazelnut Teo\nEspecialista en cariÃ±o, contenciÃ³n y abrazos terapÃ©uticos ğŸ«¶");
}

/* ===== AGREGAR ===== */
function agregarMedicacion() {
  db.ref("medicacion").push({
    nombre: medNombre.value,
    horario: medHorario.value
  });
  confirmar("Medicamento guardado");
}

function agregarControl() {
  db.ref("controles").push({
    nombre: controlNombre.value,
    fecha: controlFecha.value
  });
  confirmar("Control guardado");
}

function agregarExamen() {
  db.ref("examenes").push({
    nombre: examNombre.value,
    fecha: examFecha.value
  });
  confirmar("Examen guardado");
}

function agregarPresion() {
  db.ref("presion").push({
    m1: p1.value,
    m2: p2.value,
    m3: p3.value,
    fecha: new Date().toLocaleString()
  });
  confirmar("PresiÃ³n registrada");
}

/* ===== CARGAR ===== */
function cargarDatos() {
  cargar("medicacion", "listaMedicacion", d => `${d.nombre} - ${d.horario}`);
  cargar("controles", "listaControles", d => `${d.nombre} (${d.fecha})`);
  cargar("examenes", "listaExamenes", d => `${d.nombre} (${d.fecha})`);
  cargar("presion", "listaPresion", d => 
    `ğŸ•’ ${d.fecha}: ${d.m1} / ${d.m2} / ${d.m3}`);
}

function cargar(ruta, listaId, formato) {
  const ul = document.getElementById(listaId);
  db.ref(ruta).on("value", snap => {
    ul.innerHTML = "";
    snap.forEach(s => {
      const li = document.createElement("li");
      li.innerHTML = formato(s.val()) +
        ` <button class="danger" onclick="eliminar('${ruta}','${s.key}')">X</button>`;
      ul.appendChild(li);
    });
  });
}

function eliminar(ruta, key) {
  if (confirm("Â¿Eliminar registro?")) {
    db.ref(`${ruta}/${key}`).remove();
  }
}

function confirmar(msg) {
  document.getElementById("confirmacion").innerText = msg;
  setTimeout(()=>confirmacion.innerText="", 3000);
}
</script>

</body>
</html>
