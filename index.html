<!DOCTYPE html>
<html lang="es">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anexo Residencial UC Christus</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBhN4t3uGfDwRZwN9r_k7egf5PjssfofJI",
  authDomain: "residencial-6b6b7.firebaseapp.com",
  databaseURL: "https://residencial-6b6b7-default-rtdb.firebaseio.com",
  projectId: "residencial-6b6b7",
  storageBucket: "residencial-6b6b7.firebasestorage.app",
  messagingSenderId: "171840259391",
  appId: "1:171840259391:web:c8d26aec2fc91f8058bf8a"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background:#eef2f7;
  margin:0;
  padding:10px;
}
.container {
  max-width:500px;
  margin:auto;
  background:white;
  border-radius:15px;
  box-shadow:0 4px 15px rgba(0,0,0,.1);
  overflow:hidden;
}
.header {
  background:#007bff;
  color:white;
  padding:20px;
  text-align:center;
}
.nav {
  display:flex;
  background:#f8f9fa;
}
.nav div {
  flex:1;
  padding:10px;
  text-align:center;
  cursor:pointer;
  font-weight:bold;
  font-size:11px;
  color:#555;
}
.nav div.active {
  background:white;
  color:#007bff;
  border-bottom:3px solid #007bff;
}
.section {
  display:none;
  padding:20px;
}
.section.active {
  display:block;
}
input, textarea, button {
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button {
  background:#28a745;
  color:white;
  font-weight:bold;
  border:none;
}
.help {
  font-size:12px;
  color:#666;
}
.info-box {
  background:#f1f8ff;
  padding:10px;
  border-radius:8px;
  margin-top:10px;
  font-size:13px;
}
iframe {
  width:100%;
  border:0;
  border-radius:10px;
}
img.avatar {
  width:60px;
  height:60px;
  border-radius:50%;
}
hr {
  border:none;
  border-top:1px solid #eee;
  margin:15px 0;
}
ul {
  padding-left:20px;
}
</style>
</head>

<body>

<div class="container">

<!-- HEADER -->
<div class="header">
  <h2>Anexo Residencial UC Christus</h2>
  <small>Unidad de Recuperaci√≥n y Regaloneo</small>
</div>

<!-- NAV -->
<div class="nav">
  <div class="active" onclick="openTab('inicio', this)">RESIDENCIA</div>
  <div onclick="openTab('paciente', this)">PACIENTE</div>
  <div onclick="openTab('equipo', this)">EQUIPO</div>
  <div onclick="openTab('ubicacion', this)">UBICACI√ìN</div>
</div>

<!-- RESIDENCIA -->
<div id="inicio" class="section active">
  <h3>Descripci√≥n de la Residencia</h3>
  <p>
    Unidad de recuperaci√≥n domiciliaria post-alta, orientada al bienestar,
    estabilidad cl√≠nica, emocional y cuidado integral de la paciente.
  </p>
  <div class="info-box">
    üëâ Para reservar visitas debe ingresar a la secci√≥n <strong>Paciente</strong>.
  </div>
</div>

<!-- PACIENTE -->
<div id="paciente" class="section">

<h3>Acceso Paciente</h3>

<div id="login">
  <input id="rut" placeholder="RUT del paciente">
  <div class="help">Ingrese RUT sin puntos y con guion</div>
  <input id="fecha" type="date">
  <button onclick="login()">Ingresar</button>
</div>

<div id="ficha" style="display:none">

<hr>
<h4>Ficha Cl√≠nica</h4>

<div class="info-box" style="display:flex;gap:10px;align-items:center;">
  <img src="images/paciente.jpg" class="avatar">
  <div>
    <strong>Margarita De Las Mercedes Arriaza Zamorano</strong><br>
    <small>RUT: 6.921.444-4</small>
  </div>
</div>

<p><strong>Nacimiento:</strong> 06-01-1951</p>
<p><strong>Ingreso Residencial:</strong> 01-02-2026</p>
<p><strong>Unidad:</strong> Recuperaci√≥n Card√≠aca Domiciliaria</p>

<hr>
<h4>Diagn√≥stico</h4>
<div class="info-box">
  Recuperaci√≥n post-alta card√≠aca en ambiente familiar controlado.
</div>

<hr>
<h4>M√©dico Tratante</h4>

<div class="info-box" onclick="toggleMedico()" style="cursor:pointer;display:flex;gap:10px;">
  <img src="images/doctor-teo.jpg" class="avatar">
  <div>
    <strong>Dr. Hazelnut Teo</strong><br>
    <small>Especialista en cari√±o</small>
  </div>
</div>

<div id="infoMedico" class="info-box" style="display:none;">
  Cardiolog√≠a emocional, contenci√≥n afectiva y regaloneo terap√©utico avanzado.
</div>

<hr>
<h4>Medicaci√≥n actual</h4>
<ul id="listaMedicacion"></ul>

<hr>
<h4>Reserva de Visitas</h4>
<button onclick="mostrarCalendly()">Reservar visita</button>

<div id="calendly" style="display:none;margin-top:15px;">
  <iframe src="https://calendly.com/mfrq89/30min" height="600"></iframe>
</div>

</div>
</div>

<!-- EQUIPO -->
<div id="equipo" class="section">
<h3>Equipo M√©dico</h3>

<label>ü©∫ Medicaci√≥n actual</label>
<textarea id="medicacion" rows="4" placeholder="Una por l√≠nea"></textarea>

<label>üìã Indicaciones / controles</label>
<textarea id="controles" rows="4" placeholder="Una por l√≠nea"></textarea>

<label>üß™ Ex√°menes</label>
<textarea id="examenes" rows="4" placeholder="Una por l√≠nea"></textarea>

<button onclick="guardarEquipo()">Guardar informaci√≥n</button>
<p id="estadoGuardado" class="help"></p>
</div>

<!-- UBICACI√ìN -->
<div id="ubicacion" class="section">
<h3>Ubicaci√≥n</h3>
<p>Pasaje Cerro Cordillera 4686, Pe√±aflor</p>
<iframe
  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3323.0858591025353!2d-70.88335822437418!3d-33.60307667332938"
  height="300">
</iframe>
</div>

</div>

<script>
const PACIENTE_RUT = "6921444-4";
const PACIENTE_FECHA = "1951-01-06";

function login() {
  if (
    document.getElementById("rut").value === PACIENTE_RUT &&
    document.getElementById("fecha").value === PACIENTE_FECHA
  ) {
    document.getElementById("login").style.display = "none";
    document.getElementById("ficha").style.display = "block";
  } else {
    alert("Datos incorrectos");
  }
}

function toggleMedico() {
  const m = document.getElementById("infoMedico");
  m.style.display = m.style.display === "none" ? "block" : "none";
}

function mostrarCalendly() {
  document.getElementById("calendly").style.display = "block";
}

function openTab(id, el) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav div").forEach(n => n.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  el.classList.add("active");
}

function limpiarLineas(texto) {
  return texto.split("\n").map(l => l.trim()).filter(l => l !== "");
}

function guardarEquipo() {
  const data = {
    medicacion: limpiarLineas(document.getElementById("medicacion").value),
    controles: limpiarLineas(document.getElementById("controles").value),
    examenes: limpiarLineas(document.getElementById("examenes").value),
    actualizado: new Date().toLocaleString("es-CL")
  };

  database.ref("equipo_medico").set(data)
    .then(() => {
      document.getElementById("estadoGuardado").innerText =
        "‚úÖ Informaci√≥n guardada correctamente";
    });
}

database.ref("equipo_medico").on("value", snapshot => {
  const d = snapshot.val();
  if (!d || !d.medicacion || d.medicacion.length === 0) {
    document.getElementById("listaMedicacion").innerHTML =
      "<li>No hay medicaci√≥n registrada</li>";
    return;
  }
  document.getElementById("listaMedicacion").innerHTML =
    d.medicacion.map(m => `<li>${m}</li>`).join("");
});
</script>

</body>
</html>
